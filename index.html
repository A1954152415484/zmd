<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>终末地 // 工业合成终端 V7.0</title>
    <style>
        :root { --bg: #0a0a0a; --accent: #ff4d00; --panel: #151515; --text: #e0e0e0; --border: #333; }
        body { background: var(--bg); color: var(--text); font-family: "Segoe UI", sans-serif; margin: 0; display: flex; height: 100vh; }
        
        /* 布局 */
        .sidebar { width: 300px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .main-view { flex: 1; position: relative; background: radial-gradient(circle at center, #111 0%, #050505 100%); overflow: hidden; }
        
        /* UI组件 */
        .header { padding: 20px; border-bottom: 2px solid var(--accent); font-weight: bold; letter-spacing: 1px; }
        #item-list { flex: 1; overflow-y: auto; padding: 10px; }
        .item-card { padding: 12px; margin-bottom: 5px; background: #000; border: 1px solid #222; cursor: pointer; transition: 0.2s; }
        .item-card:hover { border-color: var(--accent); background: #1a0a00; }
        
        .admin-btn { background: transparent; border: 1px solid var(--accent); color: var(--accent); padding: 10px; cursor: pointer; margin: 15px; }
        .admin-panel { display: none; padding: 15px; background: #1a1a1a; border-top: 1px solid var(--border); }
        input { background: #000; border: 1px solid var(--border); color: #fff; padding: 10px; width: 100%; margin-bottom: 10px; box-sizing: border-box; }
        .save-btn { background: var(--accent); color: #000; border: none; font-weight: bold; padding: 10px; width: 100%; cursor: pointer; }
        
        #status-tag { position: fixed; bottom: 10px; right: 10px; font-size: 10px; color: #555; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="header">工业合成终端 // V7.0</div>
        <div id="item-list">加载中...</div>
        
        <button class="admin-btn" onclick="document.getElementById('admin-panel').style.display='block'">进入管理模式</button>
        
        <div id="admin-panel" class="admin-panel">
            <div style="font-size:12px; color:var(--accent); margin-bottom:10px;">添加新条目:</div>
            <input type="text" id="node-name" placeholder="名称 (如: 铁矿)">
            <button class="save-btn" onclick="generateSave()">生成并跳转保存</button>
            <p style="font-size:10px; color:#666; margin-top:10px;">* 为了安全，保存将跳转至 GitHub 编辑页，请直接点击“Commit changes”即可。</p>
        </div>
    </div>

    <div class="main-view">
        <div style="position:absolute; top:45%; left:50%; transform:translate(-50%,-50%); text-align:center; pointer-events:none;">
            <h1 style="font-size: 5rem; margin:0; opacity:0.05;">ENDfield</h1>
            <p style="color:var(--accent); font-family:monospace; opacity:0.4;">CENTRAL DATA TERMINAL</p>
        </div>
    </div>

    <div id="status-tag">STATUS: ONLINE</div>

    <script>
        const REPO = "A1954152415484/zmd";
        const DATA_PATH = "data.json";
        let state = { items: [], recipes: {} };

        // 1. 访客读取数据 (直接读取仓库文件)
        async function loadData() {
            try {
                // 使用 raw 链接确保拿到最新数据
                const url = `https://raw.githubusercontent.com/${REPO}/main/${DATA_PATH}?t=${Date.now()}`;
                const res = await fetch(url);
                if (!res.ok) throw new Error();
                state = await res.json();
                renderItems();
            } catch (e) {
                document.getElementById('item-list').innerText = "数据加载失败，请检查仓库 data.json";
            }
        }

        function renderItems() {
            const container = document.getElementById('item-list');
            container.innerHTML = state.items.length ? '' : '<p style="color:#444">暂无数据</p>';
            state.items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'item-card';
                div.innerHTML = `<span>●</span> ${item.name}`;
                container.appendChild(div);
            });
        }

        // 2. 管理员保存逻辑 (绝对安全跳转)
        function generateSave() {
            const name = document.getElementById('node-name').value;
            if (!name) return alert("请输入名称");

            // 更新本地状态
            state.items.push({ id: Date.now(), name: name });

            // 格式化为 JSON 字符串
            const jsonString = JSON.stringify(state, null, 2);

            // 核心：跳转到 GitHub 官方的文件编辑页面
            // 这个页面会自动带上你修改后的内容
            const githubUrl = `https://github.com/${REPO}/edit/main/${DATA_PATH}?message=Update+Data&value=${encodeURIComponent(jsonString)}`;
            
            // 提示用户
            if (confirm("数据已准备就绪。点击确定后，请在打开的 GitHub 页面下方点击蓝色按钮 'Commit changes' 即可完成发布。")) {
                window.open(githubUrl, '_blank');
            }
        }

        window.onload = loadData;
    </script>
</body>
</html>
