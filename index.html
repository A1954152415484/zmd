<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>终末地 // 工业合成终端</title>
    <style>
        :root { --bg: #0a0a0a; --accent: #ff4d00; --panel: #151515; --text: #e0e0e0; --border: #333; }
        body { background: var(--bg); color: var(--text); font-family: "Segoe UI", sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* 侧边栏 */
        .sidebar { width: 300px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .header { padding: 20px; border-bottom: 2px solid var(--accent); font-weight: bold; font-size: 14px; letter-spacing: 1px; color: var(--accent); }
        
        /* 数据列表 */
        #item-list { flex: 1; overflow-y: auto; padding: 10px; }
        .item-card { padding: 12px; margin-bottom: 5px; background: #000; border: 1px solid #222; cursor: pointer; font-size: 14px; transition: 0.2s; }
        .item-card:hover { border-color: var(--accent); color: var(--accent); }
        
        /* 只有管理员可见的区域 */
        #admin-zone { display: none; padding: 15px; background: #1a100a; border-top: 1px solid var(--accent); }
        input { background: #000; border: 1px solid var(--border); color: #fff; padding: 10px; width: 100%; margin-bottom: 10px; box-sizing: border-box; outline: none; }
        input:focus { border-color: var(--accent); }
        .save-btn { background: var(--accent); color: #000; border: none; font-weight: bold; padding: 10px; width: 100%; cursor: pointer; }

        /* 主展示区 */
        .main-view { flex: 1; position: relative; background: #050505; display: flex; justify-content: center; align-items: center; }
        .watermark { font-size: 6rem; font-weight: 900; opacity: 0.03; letter-spacing: 15px; position: absolute; }
        #canvas { z-index: 2; width: 100%; height: 100%; }

        #status-tag { position: fixed; bottom: 10px; right: 10px; font-size: 9px; color: #333; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="header">CENTRAL TERMINAL // 数据库</div>
        <div id="item-list">正在读取工业链路...</div>
        
        <div id="admin-zone">
            <div style="font-size:11px; color:var(--accent); margin-bottom:8px;">管理员控制台:</div>
            <input type="text" id="node-name" placeholder="录入新物资名称">
            <button class="save-btn" onclick="adminSave()">同步至云端</button>
        </div>
    </div>

    <div class="main-view">
        <div class="watermark">ENDFIELD</div>
        <div id="canvas">
            </div>
    </div>

    <div id="status-tag">CORE_V7.2_SECURE</div>

    <script>
        const REPO = "A1954152415484/zmd";
        let state = { items: [], recipes: {} };

        // 1. 初始化检查：是否是管理员
        function checkIdentity() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('admin') === 'true') {
                document.getElementById('admin-zone').style.display = 'block';
                console.log("管理员模式已激活");
            }
        }

        // 2. 纯净读取数据
        async function loadData() {
            try {
                const res = await fetch('data.json', { cache: 'no-store' });
                if (!res.ok) throw new Error();
                state = await res.json();
                renderItems();
            } catch (e) {
                document.getElementById('item-list').innerHTML = "<p style='color:red; padding:10px;'>数据链路断开</p>";
            }
        }

        function renderItems() {
            const container = document.getElementById('item-list');
            if (!state.items || state.items.length === 0) {
                container.innerHTML = "<p style='color:#444; padding:10px;'>暂无公开数据</p>";
                return;
            }
            container.innerHTML = state.items.map(item => `
                <div class="item-card" onclick="alert('选中了: ${item.name}')">
                    <span style="color:var(--accent)">●</span> ${item.name}
                </div>
            `).join('');
        }

        // 3. 安全保存 (依然利用 GitHub 官方保护)
        function adminSave() {
            const name = document.getElementById('node-name').value;
            if (!name) return;

            state.items.push({ id: Date.now(), name: name });
            const jsonString = JSON.stringify(state, null, 2);

            // 跳转到 GitHub 编辑页
            const editUrl = `https://github.com/${REPO}/edit/main/data.json?message=Update+Industrial+Data&value=${encodeURIComponent(jsonString)}`;
            
            if (confirm("确定要发布更新吗？这需要跳转到 GitHub 进行安全验证。")) {
                window.open(editUrl, '_blank');
            }
        }

        window.onload = () => {
            checkIdentity();
            loadData();
        };
    </script>
</body>
</html>
